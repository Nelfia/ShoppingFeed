{extends file="admin-layout.tpl"}

{block name="after-bootstrap-css"}

{/block}

{block name="no-return-functions"}
    {$admin_current_location = 'module'}
{/block}

{block name="page-title"}{intl l='ShoppingFeed module configuration' d='shoppingfeed.bo.default'}{/block}

{block name="check-resource"}admin.module{/block}
{block name="check-access"}view{/block}
{block name="check-module"}ShoppingFeed{/block}

{block name="main-content"}
{$current_tab = $smarty.get.current_tab|default:"feeds"}
<div class="modules-configure">
    <div id="wrapper" class="container">
        <div class="clearfix">
            <ul class="breadcrumb pull-left">
                <li><a href="{url path='/admin/home'}">{intl l="Home"}</a></li>
                <li><a href="{url path='/admin/modules'}">{intl l="Modules"}</a></li>
                <li><a href="#">{intl l="Configure"}
                        : {loop type="module" name="module-name" code='shoppingfeed'}{$CODE} - {$TITLE}{/loop}</a></li>
            </ul>
        </div>

        <div class="general-block-decorator" id="ShoppingFeed">

            <div class="row">
                <div class="col-md-12">
                    <!-- Tab menu -->
                    <ul id="tabbed-menu" class="nav nav-tabs">
                        <li {if $current_tab === "feeds"}class="active"{/if}><a data-toggle="tab" href="#feeds">{intl l="Feeds"  d='shoppingfeed.bo.default'}</a></li>
                        <li {if $current_tab === "configuration"}class="active"{/if}><a data-toggle="tab" href="#configuration">{intl l="Configuration"  d='shoppingfeed.bo.default'}</a></li>
                        <li {if $current_tab === "logs"}class="active"{/if}><a data-toggle="tab" href="#logs">{intl l="Logs"  d='shoppingfeed.bo.default'}</a></li>
                    </ul>

                    <div class="tab-content">
                        <div id="feeds" class="tab-pane {if $current_tab === "feeds"}active{/if} form-container">
                            {foreach from=$configs item=config}
                                {form name="shoppingfeed_feed_configuration_form"}
                                    <form action="{url path="/admin/module/ShoppingFeed/config"}/{$config->getId()}" method="post">
                                        {form_hidden_fields form=$form}

                                        {if $form_error}
                                            <div class="alert alert-danger">{$form_error_message}</div>
                                        {/if}

                                        {form_field form=$form field='success_url'}
                                            <input type="hidden" name="{$name}" value="{url path={navigate to="current"}}"/>
                                        {/form_field}

                                        <div class="panel-body">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {form_field form=$form field='country_id'}
                                                        <label for="{$name}">{$label}</label>
                                                        <select id="{$name}" class="form-control" name="{$name}">
                                                            {loop type="country" name="country"}
                                                                <option value="{$ID}" {if $config->getCountryId() == $ID}selected{/if}>{$TITLE}</option>
                                                            {/loop}
                                                        </select>
                                                        <small class="form-text text-muted">{intl l="This will define the tax to apply to products in feed"}</small>
                                                    {/form_field}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {form_field form=$form field='lang_id'}
                                                        <label for="{$name}">{$label}</label>
                                                        <select id="{$name}" class="form-control" name="{$name}">
                                                            {loop type="lang" name="lang"}
                                                                <option value="{$ID}" {if $config->getLangId() == $ID}selected{/if}>{$TITLE}</option>
                                                            {/loop}
                                                        </select>
                                                        <small class="form-text text-muted">{intl l="This will define the language of text (e.g 'product title') in feed"}</small>
                                                    {/form_field}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {form_field form=$form field='store_id'}
                                                        <label for="{$name}">{$label}</label>

                                                        <input id="{$name}"  class="form-control" type="text" name="{$name}" value="{$config->getStoreId()}"/>
                                                        <small class="form-text text-muted">{intl l="The identifier of your store, can be found in ShoppingFeed back office"}</small>
                                                    {/form_field}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {form_field form=$form field='api_token'}
                                                        <label for="{$name}">{$label}</label>

                                                        <input id="{$name}"  class="form-control" type="text" name="{$name}" value="{$config->getApiToken()}"/>
                                                        <small class="form-text text-muted">{intl l="The api token, can be found in ShoppingFeed back office"}</small>
                                                    {/form_field}
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    {$feedUrl = {url path=""}|cat:$config->getFeedFilePrefix()|cat:"_shopping_feed.xml"|replace:'/index.php':''|replace:'/index_dev.php':''}}
                                                    {intl l="The url of your feed file is "} <a href="{$feedUrl}">{$feedUrl}</a>
                                                </div>
                                            </div>
                                            <br>
                                            <div class="col-md-9">
                                                <input type="submit" class="btn btn-info form-control" value="{intl l="Save"}">
                                            </div>
                                            <div class="col-md-3">
                                                <a  class="btn btn-danger form-control" href="{url path="/admin/module/ShoppingFeed/config/delete"}/{$config->getId()}">{intl l="Delete"}</a>
                                            </div>
                                        </div>
                                    </form>
                                {/form}
                                <hr>
                            {/foreach}
                            {form name="shoppingfeed_feed_configuration_form"}
                                <form action="{url path="/admin/module/ShoppingFeed/config"}" method="post">
                                    {form_hidden_fields form=$form}

                                    {if $form_error}
                                        <div class="alert alert-danger">{$form_error_message}</div>
                                    {/if}

                                    {form_field form=$form field='success_url'}
                                        <input type="hidden" name="{$name}" value="{url path={navigate to="current"}}"/>
                                    {/form_field}

                                    <div class="panel-body">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                {form_field form=$form field='country_id'}
                                                    <label for="{$name}">{$label}</label>
                                                    <select id="{$name}" class="form-control" name="{$name}">
                                                        {loop type="country" name="country"}
                                                            <option value="{$ID}" {if {$value} == $ID || (empty($value) && $IS_DEFAULT)}selected{/if}>{$TITLE}</option>
                                                        {/loop}
                                                    </select>
                                                    <small class="form-text text-muted">{intl l="This will define the tax to apply to products in feed"}</small>
                                                {/form_field}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                {form_field form=$form field='lang_id'}
                                                    <label for="{$name}">{$label}</label>
                                                    <select id="{$name}" class="form-control" name="{$name}">
                                                        {loop type="lang" name="lang"}
                                                            <option value="{$ID}" {if {$value} == $ID || (empty($value) && $IS_DEFAULT)}selected{/if}>{$TITLE}</option>
                                                        {/loop}
                                                    </select>
                                                    <small class="form-text text-muted">{intl l="This will define the language of text (e.g 'product title') in feed"}</small>
                                                {/form_field}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                {form_field form=$form field='store_id'}
                                                    <label for="{$name}">{$label}</label>

                                                    <input id="{$name}"  class="form-control" type="text" name="{$name}" value="{$value}"/>
                                                    <small class="form-text text-muted">{intl l="The identifier of your store, can be found in ShoppingFeed back office"}</small>
                                                {/form_field}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                {form_field form=$form field='api_token'}
                                                    <label for="{$name}">{$label}</label>

                                                    <input id="{$name}"  class="form-control" type="text" name="{$name}" value="{$value}"/>
                                                    <small class="form-text text-muted">{intl l="The api token, can be found in ShoppingFeed back office"}</small>
                                                {/form_field}
                                            </div>
                                        </div>
                                        <br>
                                        <div class="col-md-12">
                                            <input type="submit" class="btn btn-success form-control" value="{intl l="Create"}">
                                        </div>
                                    </div>
                                </form>
                            {/form}
                        </div>
                        <div id="logs" class="tab-pane {if $current_tab === "configuration"}active{/if} form-container">
                            <div>Bonjour les logs</div>
                        </div>
                        <div id="logs" class="tab-pane {if $current_tab === "logs"}active{/if} form-container">
                            <div>Bonjour les logs</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {/block}

    {block name="javascript-initialization"}

{/block}